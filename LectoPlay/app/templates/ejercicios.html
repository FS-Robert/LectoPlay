{% extends 'home.html' %}

{% block title %}Ejercicios | LectoPlay{% endblock %}

{% block content %}

<style>
    /* Bot√≥n flotante del narrador */
    #tts-btn {
        position: fixed;
        bottom: 30px;
        left: 30px;
        background: #ffafcc;
        color: white;
        padding: 15px 25px;
        border-radius: 50px;
        font-size: 16px;
        border: none;
        cursor: pointer;
        font-weight: bold;
        box-shadow: 0px 4px 15px rgba(255, 175, 204, 0.6);
        z-index: 9999;
        transition: transform 0.2s, background 0.2s;
    }

    #tts-btn:hover {
        transform: scale(1.05);
        background: #ff8ab7;
    }

    /* Efecto hover en las tarjetas */
    .game-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: none;
        border-radius: 20px;
        background: white;
    }

    .game-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1) !important;
    }

    /* Iconos grandes */
    .game-icon {
        font-size: 3.5rem;
        margin-bottom: 15px;
        display: inline-block;
    }
</style>

<button id="tts-btn" onclick="activarTTS()">üîä Activar narrador</button>

<div class="container py-5">
    
    <div class="text-center mb-5">
        <h1 class="fw-bold" style="color: #023047;">üß© Ejercicios Divertidos</h1>
        <p class="lead text-muted">Aprende y juega con estos ejercicios interactivos.</p>
        
        <button onclick="leerTexto('Ejercicios Divertidos. Aprende y juega con estos ejercicios interactivos.')" 
                class="btn btn-outline-info btn-sm rounded-pill mt-2">
            üîä Escuchar de nuevo
        </button>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 justify-content-center">

        <div class="col">
            <div class="card h-100 shadow-sm game-card" style="border-top: 5px solid #a2d2ff;">
                <div class="card-body text-center p-4 d-flex flex-column">
                    <div class="game-icon">üìñ</div>
                    <h3 class="h4 card-title fw-bold" style="color: #219ebc;">Lectura R√°pida</h3>
                    <p class="card-text text-muted flex-grow-1">Lee frases cortas y responde preguntas para mejorar tu comprensi√≥n.</p>
                    <a href="{% url 'lectura_rapida_game' %}" class="btn w-100 fw-bold mt-3" style="background-color: #a2d2ff; color: #023047;">Jugar Ahora</a>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card h-100 shadow-sm game-card" style="border-top: 5px solid #ffafcc;">
                <div class="card-body text-center p-4 d-flex flex-column">
                    <div class="game-icon">üé®</div>
                    <h3 class="h4 card-title fw-bold" style="color: #ff5d8f;">Palabras y Colores</h3>
                    <p class="card-text text-muted flex-grow-1">Asocia palabras con sus colores reales para entrenar tu atenci√≥n.</p>
                    <a href="{% url 'palabras_colores' %}" class="btn w-100 fw-bold mt-3" style="background-color: #ffafcc; color: white;">Jugar Ahora</a>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card h-100 shadow-sm game-card" style="border-top: 5px solid #ffd166;">
                <div class="card-body text-center p-4 d-flex flex-column">
                    <div class="game-icon">üî§</div>
                    <h3 class="h4 card-title fw-bold" style="color: #fb8500;">Encuentra la Letra</h3>
                    <p class="card-text text-muted flex-grow-1">Convi√©rtete en detective e identifica letras escondidas.</p>
                    <a href="{% url 'encuentra' %}" class="btn w-100 fw-bold mt-3" style="background-color: #ffd166; color: white;">Jugar Ahora</a>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card h-100 shadow-sm game-card" style="border-top: 5px solid #cdb4db;">
                <div class="card-body text-center p-4 d-flex flex-column">
                    <div class="game-icon">‚úèÔ∏è</div>
                    <h3 class="h4 card-title fw-bold" style="color: #9d4edd;">Escribe la Palabra</h3>
                    <p class="card-text text-muted flex-grow-1">Lee una descripci√≥n y escribe la palabra correcta.</p>
                    <a href="{% url 'desc_palabra' %}" class="btn w-100 fw-bold mt-3" style="background-color: #cdb4db; color: white;">Jugar Ahora</a>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card h-100 shadow-sm game-card" style="border-top: 5px solid #bde0fe;">
                <div class="card-body text-center p-4 d-flex flex-column">
                    <div class="game-icon">‚úÖ</div>
                    <h3 class="h4 card-title fw-bold" style="color: #0077b6;">Palabra o no</h3>
                    <p class="card-text text-muted flex-grow-1">Diferencia palabras reales de las inventadas.</p>
                    <a href="{% url 'pnp' %}" class="btn w-100 fw-bold mt-3" style="background-color: #bde0fe; color: #023047;">Jugar Ahora</a>
                </div>
            </div>
        </div>

    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Variable global para referencia del audio actual
window.currentUtterance = null;

function narrarSecuencia(lista, ttsBtn) {
    if (lista.length === 0) {
        console.log("Secuencia terminada.");
        if (ttsBtn) {
            ttsBtn.textContent = 'üîä Activar narrador';
        }
        return;
    }

    console.log("Reproduciendo:", lista[0]);

    window.currentUtterance = new SpeechSynthesisUtterance(lista[0]);
    window.currentUtterance.lang = "es-ES";
    window.currentUtterance.rate = 0.9;

    window.currentUtterance.onend = function() {
        narrarSecuencia(lista.slice(1), ttsBtn);
    };

    window.currentUtterance.onerror = function(event) {
        console.error("Error en TTS:", event);
        narrarSecuencia(lista.slice(1), ttsBtn);
    };

    window.speechSynthesis.speak(window.currentUtterance);
}

function leerTexto(texto) {
    window.speechSynthesis.cancel();
    
    const ttsBtn = document.getElementById('tts-btn');
    if (ttsBtn && ttsBtn.textContent.includes('Desactivar')) {
        ttsBtn.textContent = 'üîä Activar narrador';
    }

    const speech = new SpeechSynthesisUtterance(texto);
    speech.lang = "es-ES";
    window.speechSynthesis.speak(speech);
}

function activarTTS() {
    const ttsBtn = document.getElementById('tts-btn');
    
    if (ttsBtn.textContent.includes('Desactivar')) {
        window.speechSynthesis.cancel();
        ttsBtn.textContent = 'üîä Activar narrador';
        console.log("Narrador detenido por el usuario.");
        return;
    }

    console.log("Iniciando narrador...");
    window.speechSynthesis.cancel();
    
    ttsBtn.textContent = 'üõë Desactivar narrador';

    const mensajes = [
        "Ejercicios Divertidos. Aprende y juega con estos ejercicios interactivos.",
        "Elige entre los distintos ejercicios.",
        "Lectura R√°pida: lee frases cortas y responde preguntas.",
        "Palabras y Colores: asocia palabras con colores.",
        "Encuentra la Letra: identifica letras escondidas.",
        "Escribe la Palabra: lee una descripci√≥n y escribe la palabra correcta.",
        "Palabra o no palabra: diferencia palabras reales e inventadas.",
        "Divi√©rtete aprendiendo con los ejercicios."
    ];

    narrarSecuencia(mensajes, ttsBtn);
}
</script>

<script>
window.addEventListener("beforeunload", function () {
    window.speechSynthesis.cancel();
});
</script>
{% endblock %}