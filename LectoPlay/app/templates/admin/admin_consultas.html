{% extends "home.html" %}

{% block title %}Panel de Consultas | LectoPlay{% endblock %}

{% block content %}

<div class="consultas-main-container">

    <h1 class="page-title">Panel de Consultas</h1>

    {% if tickets %}
        <div class="tickets-grid">
            {% for item in tickets %}
            {% with ticket=item.ticket %}
            
            <article class="ticket-card">
                <div class="card-header-row">
                    <div class="user-info">
                        <div class="avatar-circle">
                            {{ ticket.contacto.nombre|slice:":1"|upper }}
                        </div>
                        <div class="user-text">
                            <h3>{{ ticket.contacto.nombre }}</h3>
                            <span>{{ ticket.contacto.correo }}</span>
                        </div>
                    </div>
                    <div class="date-badge">
                         {{ ticket.creado|date:"d/m" }}
                    </div>
                </div>

                <div class="card-body">
                    <div class="message-box">
                        {{ ticket.contacto.mensaje|truncatechars:120 }}
                    </div>
                </div>

                <div class="card-footer">
                    <form method="get" action="{% url 'cambiar_estado' ticket.id %}">
                        <select name="estado" onchange="this.form.submit()" 
                                class="status-select status-{{ ticket.estado }}">
                            <option value="pendiente" {% if ticket.estado == 'pendiente' %}selected{% endif %}>ðŸŸ¡ Pendiente</option>
                            <option value="respondido" {% if ticket.estado == 'respondido' %}selected{% endif %}>ðŸ”µ Respondido</option>
                            <option value="finalizado" {% if ticket.estado == 'finalizado' %}selected{% endif %}>ðŸŸ¢ Finalizado</option>
                        </select>
                    </form>

                    <a href="{% url 'consulta_detalle' ticket.id %}" class="btn-chat">
                        Abrir Chat ðŸ’¬
                    </a>
                </div>
            </article>

            {% endwith %}
            {% endfor %}
        </div>

    {% else %}
        <div class="empty-state">
            <div class="empty-icon"></div>
            <h3>Â¡Todo limpio!</h3>
            <p>No tienes consultas pendientes en este momento.</p>
        </div>
    {% endif %}

</div>

{% endblock %}