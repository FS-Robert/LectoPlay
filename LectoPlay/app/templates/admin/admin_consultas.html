{% extends "home.html" %}

{% block title %}Consultas de Usuarios{% endblock %}

{% block content %}

<h1 style="margin-bottom: 20px;">ğŸ“¨ Consultas de Usuarios</h1>

{% if tickets %}
<div style="display: flex; flex-direction: column; gap: 20px;">

    {% for item in tickets %}
    {% with ticket=item.ticket %}
    <div style="
        background: #ffffff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.12);
        display: flex;
        flex-direction: column;
        gap: 10px;
    ">
        <!-- Encabezado tipo correo -->
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h3 style="margin: 0;">ğŸ‘¤ {{ ticket.contacto.nombre }}</h3>
                <p style="margin: 0; color: #555;"><strong>ğŸ“§</strong> {{ ticket.contacto.correo }}</p>
            </div>
            <div style="text-align: right;">
                <p style="margin: 0;"><strong>ğŸ“…</strong> {{ ticket.creado|date:"d/m/Y H:i" }}</p>
                <p style="margin: 0;"><strong>â³</strong> {{ ticket.estado|title }}</p>
            </div>
        </div>

        <!-- Mensaje -->
        <div style="
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            font-size: 15px;
            color: #333;
        ">
            <strong>ğŸ’¬ Mensaje:</strong><br>
            {{ ticket.contacto.mensaje|truncatechars:160 }}
        </div>

        <!-- Estado y acciones -->
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
            <form method="get" action="{% url 'cambiar_estado' ticket.id %}">
                <label><strong>Cambiar estado:</strong></label><br>
                <select name="estado" onchange="this.form.submit()" style="
                    padding: 8px;
                    border-radius: 8px;
                    border: 1px solid #ccc;
                    width: 180px;
                ">
                    <option value="pendiente" {% if ticket.estado == 'pendiente' %}selected{% endif %}>Pendiente</option>
                    <option value="respondido" {% if ticket.estado == 'respondido' %}selected{% endif %}>Respondido</option>
                    <option value="finalizado" {% if ticket.estado == 'finalizado' %}selected{% endif %}>Finalizado</option>
                </select>
            </form>

            <a href="{% url 'consulta_detalle' ticket.id %}" style="
                background: #4db7d8;
                padding: 10px 20px;
                border-radius: 10px;
                color: white;
                font-weight: bold;
                text-decoration: none;
                text-align: center;
            ">
                Abrir chat ğŸ’¬
            </a>
        </div>
    </div>
    {% endwith %}
    {% endfor %}

</div>
{% else %}
<p>No hay consultas todavÃ­a.</p>
{% endif %}

{% endblock %}