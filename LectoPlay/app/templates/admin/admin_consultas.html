{% extends "home.html" %}
{% load static %}

{% block title %}GestiÃ³n de Consultas | LectoPlay{% endblock %}

{% block content %}


<div class="admin-consultas-container">
    
    <div class="admin-header-row">
        <div>
            <h1>GestiÃ³n de Consultas</h1>
            <p>Revisa y responde los mensajes de los usuarios.</p>
        </div>
        {% if unread_count and unread_count > 0 %}
            <div class="badge-counter bounce">
                Tienes {{ unread_count }} sin leer
            </div>
        {% endif %}
    </div>

    {% if tickets %}
    <div class="tickets-list">
        {% for item in tickets %}
            {% with ticket=item.ticket last=item.last unread=item.unread %}
            
            <div class="full-ticket-card {% if unread %}status-unread{% else %}status-read{% endif %}">
                
                <div class="ticket-header">
                    <div class="header-left">
                        <span class="icon-status">
                            {% if unread %}ðŸ“©{% else %}âœ…{% endif %}
                        </span>
                        <span class="ticket-subject">Consulta #{{ ticket.id }} - {{ ticket.contacto.nombre }}</span>
                    </div>
                    <div class="header-right">
                        <span class="date-badge">
                            ðŸ“… {{ ticket.creado|date:"d/m/Y H:i" }}
                        </span>
                    </div>
                </div>

                <div class="ticket-body">
                    <div class="row-split">
                        
                        <div class="col-msg">
                            <div class="user-meta">
                                <strong>Usuario:</strong> {{ ticket.contacto.correo }}
                            </div>
                            
                            <div class="message-box">
                                <h6 class="msg-label">Ãšltimo mensaje:</h6>
                                {% if last %}
                                    <p>"{{ last.contenido|linebreaksbr }}"</p>
                                    <small class="msg-time">Enviado: {{ last.creado|date:"d M, H:i a" }}</small>
                                {% else %}
                                    <p class="muted">No hay mensajes previos.</p>
                                {% endif %}
                            </div>
                        </div>

                        <div class="col-action">
                            <div class="action-panel">
                                <h6>Estado del Ticket</h6>
                                <span class="status-pill {% if unread %}pill-warning{% else %}pill-success{% endif %}">
                                    {% if unread %}Pendiente de respuesta{% else %}Respondido{% endif %}
                                </span>
                                
                                <hr class="mini-divider">
                                
                                <a href="{% url 'consulta_detalle' ticket.id %}" class="btn-action-block">
                                    ðŸ’¬ Abrir ConversaciÃ³n
                                </a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            {% endwith %}
        {% endfor %}
    </div>
    {% else %}
    
    <div class="empty-state-list">
        <div class="empty-icon">ðŸ“­</div>
        <h3>Bandeja de entrada vacÃ­a</h3>
        <p>Â¡Buen trabajo! No hay consultas pendientes.</p>
    </div>

    {% endif %}
</div>

{% endblock %}