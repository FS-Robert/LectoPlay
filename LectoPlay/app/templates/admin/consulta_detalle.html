{% extends "home.html" %}

{% block title %}Detalle de Consulta{% endblock %}

{% block content %}

<h1>ğŸ’¬ Chat con {{ ticket.contacto.nombre }}</h1>

{% if ticket.estado != "finalizado" %}
<form action="{% url 'finalizar_ticket' ticket.id %}" method="post" style="margin-bottom: 15px;">
    {% csrf_token %}
    <button class="btn-finalizar">Finalizar conversaciÃ³n</button>
</form>
{% endif %}

<!-- CARD DEL CHAT -->
<div style="
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    background: #fff;
">

    <!-- MENSAJES -->
    <div style="max-height: 350px; overflow-y: auto; padding-right: 10px;">
        {% for m in mensajes %}
            <div style="margin-bottom: 15px;">
                <strong>
                    {% if m.autor == 'usuario' %}
                        ğŸ§‘ Usuario:
                    {% else %}
                        ğŸ› ï¸ Admin:
                    {% endif %}
                </strong>
                <p style="margin: 5px 0;">{{ m.contenido }}</p>
                <small>{{ m.creado|date:"d/m/Y H:i" }}</small>
                <hr>
            </div>
        {% endfor %}
    </div>
</div>

<!-- FORMULARIO SOLO SI NO ESTÃ FINALIZADO -->
{% if ticket.estado != "finalizado" %}
<form method="post" style="margin-top: 10px;">
    {% csrf_token %}
    <textarea name="respuesta" rows="3" placeholder="Escribe tu respuesta..." required 
     style="width:100%; border-radius:8px;"></textarea>
    <br><br>
    <button type="submit" style="width: 100%;">Responder</button>
</form>
{% else %}
<p class="finalizado-msg" style="color:red; font-weight:bold;">
    La conversaciÃ³n ha sido finalizada. Ya no puedes enviar mensajes.
</p>
{% endif %}

{% endblock %}
