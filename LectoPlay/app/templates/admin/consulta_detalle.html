{% extends "home.html" %}

{% block title %}Detalle de Consulta{% endblock %}

{% block content %}

<div style="max-width: 700px; margin: 30px auto;">

    <div style="
        background: linear-gradient(135deg, #6cbef5, #82d0ff);
        padding: 20px;
        border-radius: 15px 15px 0 0;
        color: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
    ">
        <div>
            <h2 style="margin: 0;">Detalle de Consulta</h2>
            <small style="opacity: .9;">Usuario: {{ ticket.contacto.nombre }}</small>
        </div>

        <div style="display: flex; gap: 10px; align-items: center;">
            
            <a href="{% url 'admin_consultas' %}" style="
                text-decoration: none;
                background: rgba(255, 255, 255, 0.2);
                border: 1px solid #fff;
                color: #fff;
                padding: 8px 13px;
                border-radius: 10px;
                font-weight: bold;
                font-size: 14px;
                transition: 0.3s;
            " onmouseover="this.style.background='rgba(255,255,255,0.4)'" 
               onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                ⬅ Volver
            </a>

            <form action="{% url 'finalizar_ticket' ticket.pk %}" method="post" style="margin: 0;">
                {% csrf_token %}
                <button style="
                    background:#fff;
                    padding: 8px 13px;
                    border-radius:10px;
                    border:none;
                    color:#f44336;
                    font-weight: bold;
                    cursor:pointer;
                ">Finalizar</button>
            </form>
        </div>
    </div>

    <div style="
        border: 1px solid #ccc;
        border-radius: 0 0 15px 15px;
        background:#ffffff;
        padding: 20px;
    ">

        <div style="height: 380px; overflow-y: auto; padding-right: 10px;">

           {% for m in mensajes %}
                {% if m.autor == 'usuario' %}
                    <div style="text-align: left; margin-bottom: 15px;">
                        <div style="
                            display: inline-block;
                            background: #f1f1f1;
                            color: #333;
                            padding: 10px 15px;
                            border-radius: 12px;
                            max-width: 70%;
                            text-align: left;
                        ">
                            <strong style="color:#555;">Usuario:</strong><br>
                            {{ m.contenido }}
                        </div>
                        <br>
                        <small style="color:#777;">{{ m.creado|date:"H:i d/m" }}</small>
                    </div>

                {% else %}
                    <div style="text-align: right; margin-bottom: 15px;">
                        <div style="
                            display: inline-block;
                            background: #4db7d8;
                            color: white;
                            padding: 10px 15px;
                            border-radius: 12px;
                            max-width: 70%;
                            text-align: left;
                        ">
                            {{ m.contenido }}
                        </div>
                        <br>
                        <small style="color:#777;">✓ {{ m.creado|date:"H:i d/m" }}</small>
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        {% if ticket.estado != "finalizado" %}
        <form method="post" style="margin-top: 15px;">
            {% csrf_token %}
            <div style="display:flex; gap:10px;">
                <textarea name="respuesta" rows="2" required placeholder="Escribe tu respuesta..."
                    style="
                        flex:1;
                        padding:10px;
                        border-radius:10px;
                        border:1px solid #ccc;
                        resize:none;
                    "></textarea>

                <button type="submit" style="
                    background:#4db7d8;
                    width:60px;
                    border:none;
                    border-radius:50%;
                    color:white;
                    font-size:18px;
                    cursor:pointer;
                ">➤</button>
            </div>
        </form>
        {% else %}
            <p style="color:red; font-weight:bold; text-align:center; margin-top:20px;">
                La conversación ha sido finalizada. Ya no puedes enviar mensajes.
            </p>
        {% endif %}

    </div>

</div>

{% endblock %}