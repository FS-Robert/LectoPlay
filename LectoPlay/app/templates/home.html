<!DOCTYPE html>
<html lang="es">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}LectoPlay{% endblock %}</title>

    <!-- TTS para que est√© disponible en todo el proyecto -->
    <script src="{% static 'js/tts.js' %}"></script>

    <link rel="stylesheet" href="{% static 'css/style.css' %}?v=2">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{% static 'css/chatbot.css' %}">
</head>

<body>
    
    <header>
        <nav class="navbar" style="padding: 10px 0; display: flex; align-items: center;">
            <div class="container"></div>

            <div id="user-info">
                {% if user.is_authenticated %}
                    <div class="user-avatar" style="display:flex; align-items:center; gap:10px;">
                        <img src="{% static 'css/login-avatar.png' %}" 
                             width="40" height="40" 
                             alt="avatar" class="avatar">

                        <span style="font-weight:600;">
                            {{ user.username }}
                        </span>

                        <form method="post" action="{% url 'logout' %}">
                            {% csrf_token %}
                            <button type="submit" style="
                                background:#ff6b6b; border:none; padding:6px 12px;
                                border-radius:6px; color:white; cursor:pointer;">
                                Cerrar sesi√≥n
                            </button>
                        </form>
                    </div>
                {% else %}
                    <button id="login-btn" class="login-btn" onclick="window.location.href='/login'">
                        Iniciar Sesi√≥n
                    </button>
                {% endif %}
            </div>
        </nav>
    </header>

    <script>
    document.addEventListener("keydown", function(e) {
        if (e.shiftKey && e.key.toLowerCase() === "a") {
            document.addEventListener("keydown", function secondKey(ev) {
                if (ev.key.toLowerCase() === "d") {
                    const adminBtn = document.getElementById("admin-secret-btn");
                    if(adminBtn) adminBtn.style.display = "block";
                    document.removeEventListener("keydown", secondKey);
                }
            });
        }
    });
    </script>

    <div class="white-navbar-container" style="width: 100%; background-color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.08); position: relative; z-index: 50;">
        <nav class="white-navbar" style="width: 100%; max-width: none; display: flex; align-items: center; justify-content: flex-start; padding: 10px 60px; gap: 80px;">
            <a href="{% url 'home' %}" style="display: flex; align-items: center; text-decoration: none;">
                <img src="{% static 'css/logo3.png' %}" alt="LectoPlay" class="logo-img" 
                     style="height: 65px; width: auto; object-fit: contain; transition: transform 0.3s ease;" 
                     onmouseover="this.style.transform='scale(1.05)'" 
                     onmouseout="this.style.transform='scale(1)'">
            </a>

            <ul class="nav-links" style="display: flex; align-items: center; list-style: none; gap: 50px; margin: 0; padding: 0;">
                <li><a href="{% url 'home' %}" class="active" style="text-decoration: none; color: #333; font-weight: 700; font-size: 15px; letter-spacing: 0.5px; transition: color 0.3s;" onmouseover="this.style.color='#ffafcc'" onmouseout="this.style.color='#333'">Inicio</a></li>
                <li><a href="{% url 'about' %}" style="text-decoration: none; color: #555; font-weight: 700; font-size: 15px; letter-spacing: 0.5px; transition: color 0.3s;" onmouseover="this.style.color='#ffafcc'" onmouseout="this.style.color='#555'">Acerca de</a></li>
                <li><a href="{% url 'ejercicios' %}" style="text-decoration: none; color: #555; font-weight: 700; font-size: 15px; letter-spacing: 0.5px; transition: color 0.3s;" onmouseover="this.style.color='#ffafcc'" onmouseout="this.style.color='#555'">Ejercicios</a></li>
                <li><a href="{% url 'contacto' %}" style="text-decoration: none; color: #555; font-weight: 700; font-size: 15px; letter-spacing: 0.5px; transition: color 0.3s;" onmouseover="this.style.color='#ffafcc'" onmouseout="this.style.color='#555'">Contacto</a></li>

                {% if request.user.is_authenticated and request.user.is_staff %}
                    <li style="margin-left: 20px;">
                        <a href="{% url 'admin_dashboard' %}" style="color: #fff; background-color: #ffafcc; padding: 8px 24px; border-radius: 50px; font-weight: 800; font-size: 13px; border: 2px solid #fff; box-shadow: 0 4px 8px rgba(255, 175, 204, 0.5); transition: all 0.3s ease; text-decoration: none; display: flex; align-items: center; gap: 6px;" onmouseover="this.style.backgroundColor='#f28482'; this.style.transform='translateY(-2px) scale(1.05)';" onmouseout="this.style.backgroundColor='#ffafcc'; this.style.transform='translateY(0) scale(1)';">
                            üêº Admin
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    </div>

    {% block content %}
    {% endblock %}

    <div id="chatbot-toggle" role="button" aria-label="Abrir chat">
        <svg id="chat-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22H6C4.89543 22 4 21.1046 4 20V18C4 16.8954 3.10457 16 2 16V12ZM6 18H8V20H6V18ZM12 4C7.58172 4 4 7.58172 4 12V16H20V12C20 7.58172 16.4183 4 12 4Z" fill="currentColor"/>
            <path d="M10 10C10 11.1046 9.10457 12 8 12C6.89543 12 6 11.1046 6 10C6 8.89543 6.89543 8 8 8C9.10457 8 10 8.89543 10 10Z" fill="currentColor"/>
            <path d="M18 10C18 11.1046 17.1046 12 16 12C14.8954 12 14 11.1046 14 10C14 8.89543 14.8954 8 16 8C17.1046 8 18 8.89543 18 10Z" fill="currentColor"/>
        </svg>
    </div>

    <div id="chatbot-window" class="hidden" role="dialog" aria-label="Asistente LectoPlay">
        <div id="chat-header" role="banner">
            <span>Asistente PandaPlay üêº</span>
            <button id="close-chat-btn" type="button" class="text-white hover:text-gray-200" aria-label="Cerrar chat">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x pointer-events-none" aria-hidden="true">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div id="chat-messages" aria-live="polite">
            <div class="message-bubble bot-message">
                ¬°Hola! Soy tu asistente de LectoPlay. Estoy aqu√≠ para ayudarte con las reglas de los ejercicios, la dislexia, o c√≥mo usar la plataforma. ¬øEn qu√© puedo ayudarte hoy?
            </div>
        </div>
        <form id="chat-input-form" aria-label="Formulario de chat">
            <input type="text" id="chat-input" placeholder="Escribe tu mensaje..." required aria-label="Escribe tu mensaje">
            <button type="submit" id="chat-send-btn" aria-label="Enviar mensaje">Enviar</button>
        </form>
    </div>

    <script src="{% static 'js/chatbot.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
             // Scripts globales si son necesarios
        });
    </script>

    <footer>
        <p>üêæ &copy; 2025 LectoPlay. Aprende jugando </p>
    </footer>

    <!-- BLOQUE PARA SCRIPTS ESPEC√çFICOS DE CADA TEMPLATE -->
    {% block extra_js %}{% endblock %}

</body>
</html>
